<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title><%= title %> - Lecture System</title>
    <link rel="stylesheet" href="/css/style.css">
    <style>
        .recording-container {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
        }
        
        .timer {
            font-size: 3rem;
            font-weight: bold;
            color: #007bff;
            margin: 20px 0;
            font-family: 'Courier New', monospace;
        }
        
        .recording-controls {
            margin: 30px 0;
        }
        
        .recording-btn {
            font-size: 1.2rem;
            padding: 15px 30px;
            margin: 0 10px;
            min-width: 160px;
        }
        
        .status-ready { color: #28a745; }
        .status-recording { color: #dc3545; }
        .status-processing { color: #ffc107; }
        
        #recordingProgress {
            height: 10px;
            background: #007bff;
            border-radius: 10px;
            width: 0%;
            transition: width 1s;
        }
        
        .visualizer {
            width: 100%;
            height: 100px;
            margin: 20px 0;
            background: #f8f9fa;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .audio-wave {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 2px;
        }
        
        .bar {
            width: 3px;
            background: #007bff;
            border-radius: 2px;
            transition: height 0.1s ease;
        }
    </style>
</head>
<body>
    <%- include('../partials/header') %>
    
    <div class="container">
        <div class="recording-container">
            <h1>Lecture Recording</h1>
            <h2><%= lecture.title %></h2>
            <div class="meta" style="margin-bottom: 30px;">
                <p><strong>Subject:</strong> <%= lecture.subject %> | <strong>Class:</strong> <%= lecture.class %></p>
                <p><strong>Scheduled Time:</strong> <%= lecture.schedule.startTime %> - <%= lecture.schedule.endTime %></p>
                <p><strong>Reference Material:</strong> <%= lecture.youtubeVideo?.url ? 'Available' : 'Not provided' %></p>
            </div>

            <input type="hidden" id="lectureId" value="<%= lecture._id %>">

            <!-- Recording Status -->
            <div id="statusIndicator" class="alert alert-info">
                Ready to start recording. Click Start when ready.
            </div>

            <!-- Timer Display -->
            <div class="timer" id="timer">00:00:00</div>

            <!-- Audio Visualizer -->
            <div class="visualizer" id="visualizer" style="display: none;">
                <div class="audio-wave" id="audioWave"></div>
            </div>

            <!-- Progress Bar -->
            <div style="width: 100%; background: #e9ecef; border-radius: 10px; margin: 20px 0;">
                <div id="recordingProgress" style="height: 10px; background: #007bff; border-radius: 10px; width: 0%;"></div>
            </div>

            <!-- Recording Controls -->
            <div class="recording-controls">
                <button id="startRecording" class="btn btn-success recording-btn">
                    üé§ Start Recording
                </button>
                <button id="stopRecording" class="btn btn-danger recording-btn" disabled>
                    ‚èπÔ∏è Stop Recording
                </button>
            </div>

            <!-- Status Text -->
            <div id="recordingStatus" class="status-ready" style="font-size: 1.2rem; font-weight: bold;">
                Ready to record
            </div>

            <!-- Real-time Transcript -->
            <div id="transcriptContainer" style="display: none; margin-top: 30px;">
                <h3>Live Transcript</h3>
                <div id="liveTranscript" style="
                    background: #f8f9fa;
                    padding: 20px;
                    border-radius: 10px;
                    min-height: 100px;
                    max-height: 300px;
                    overflow-y: auto;
                    text-align: left;
                    white-space: pre-wrap;
                "></div>
            </div>

            <!-- Instructions -->
            <div style="margin-top: 40px; padding: 20px; background: #f8f9fa; border-radius: 10px;">
                <h3>üìã Recording Instructions</h3>
                <ul style="text-align: left; margin: 15px 0;">
                    <li>Ensure you have a stable internet connection</li>
                    <li>Use a good quality microphone for better transcription</li>
                    <li>Speak clearly and at a moderate pace</li>
                    <li>Recording will automatically stop after 1 hour</li>
                    <li>You can stop recording anytime by clicking the stop button</li>
                    <li>Analysis will begin automatically after recording stops</li>
                </ul>
            </div>
        </div>

        <div style="text-align: center; margin-top: 30px;">
            <a href="/teacher/dashboard" class="btn btn-secondary">Back to Dashboard</a>
        </div>
    </div>

    <%- include('../partials/footer') %>
    
    <script src="/js/recording.js"></script>
</body>
</html>